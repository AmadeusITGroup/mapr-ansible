- name: Apply common configuration to all nodes
  hosts: common
  roles:
    - {role: common-oraclejdk18, when: jdk == 'oraclejdk'}
    - {role: common-openjdk18, when: jdk == 'openjdk18'}
    - common-mapruser
    - common-rpcbind
    - common-ntp
    - common-misc
    - common-sysctl
- name: Fetch files from cluster required for client
  hosts: mapr-cldb[0]
  roles:
    - mapr-client-configure-nativesecurity-fetch
- name: Setup global vars
  hosts: all
  roles:
- name: Setup global vars
  hosts: all
  roles:
    - mapr-global-vars
    - mapr-configure-vars-zk
    - mapr-configure-vars-cldb
- name: Install MapR client
  hosts: mapr-client
  roles:
    - mapr-configure-repository
    - mapr-client-install
    - mapr-configure-subnets
    - {role: mapr-client-configure-unsecure, when: mapr_security == 'none'}
    - {role: mapr-client-configure-nativesecurity-secure, when: mapr_security == 'maprsasl'}
- import_playbook: sites/mapr-include-vars.yml
- import_playbook: sites/mapr-mep-hive-client.yml
- import_playbook: sites/mapr-mep-kafka.yml
- import_playbook: sites/mapr-mep-spark.yml
- import_playbook: sites/mapr-mep-drill.yml
- import_playbook: sites/mapr-mep-flume.yml
- import_playbook: sites/mapr-mep-hbase.yml
- import_playbook: sites/mapr-mep-pig.yml
- import_playbook: sites/mapr-mep-sqoop.yml
- import_playbook: sites/mapr-mep-httpfs.yml

- name: Install NFS loopback
  hosts: mapr-nfsloopback
  roles:
    - mapr-nfsloopback-install
- name: Install mapr-posix-client-basic (FUSE)
  hosts: mapr-posix-client-basic-install
  roles:
    - mapr-posix-client-basic-install
    - {role: mapr-patch-posix-client-basic-install, when: mapr_patch_url is defined and ansible_os_family != 'Debian'}

- name: Install mapr-posix-client-platinum (FUSE)
  hosts: mapr-posix-client-platinum
  roles:
    - mapr-posix-client-platinum-install
    - {role: mapr-patch-posix-client-platinum-install, when: mapr_patch_url is defined and ansible_os_family != 'Debian'}